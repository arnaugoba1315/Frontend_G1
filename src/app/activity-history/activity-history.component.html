<div class="activity-history-container">
    <h3>Historial de cambios</h3>
    
    <div *ngIf="loading" class="loading-spinner">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
    
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
    
    <div *ngIf="!loading && histories.length === 0" class="no-history">
      No hay registros de cambios disponibles.
    </div>
    
    <div *ngIf="!loading && histories.length > 0" class="history-list">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Usuario</th>
            <th>Tipo de cambio</th>
            <th>Campos modificados</th>
            <th>Detalles</th>
          </tr>
        </thead>
        <tbody>
            <tr *ngFor="let history of histories">
                <td>{{ history.timestamp | date:'dd/MM/yyyy HH:mm' }}</td>
                <td>{{ getUserName(history) }}</td>
                <td>
                  <span class="badge" 
                        [ngClass]="{
                          'bg-success': history.changeType === 'create',
                          'bg-primary': history.changeType === 'update',
                          'bg-danger': history.changeType === 'delete'
                        }">
                    {{ getChangeTypeLabel(history.changeType) }}
                  </span>
                </td>
                <td>
                  <span *ngIf="history.changedFields?.length">
                    {{ getChangedFieldsText(history) }}
                  </span>
                  <span *ngIf="!history.changedFields?.length">-</span>
                </td>
                <td>
                  <button class="btn btn-sm btn-outline-info" (click)="toggleDetails(history)">
                    {{ isSelected(history) ? 'Ocultar' : 'Ver detalles' }}
                  </button>
                </td>
              </tr>
              <tr *ngFor="let history of histories" [hidden]="!isSelected(history)">
                <td colspan="5" class="history-details">
                  <div [ngSwitch]="history.changeType">
                    <div *ngSwitchCase="'create'">
                      <h6>Datos de la actividad creada:</h6>
                      <pre>{{ history.newValues | json }}</pre>
                    </div>
                    <div *ngSwitchCase="'update'">
                      <div class="row">
                        <div class="col-md-6">
                          <h6>Valores anteriores:</h6>
                          <pre>{{ history.previousValues | json }}</pre>
                        </div>
                        <div class="col-md-6">
                          <h6>Nuevos valores:</h6>
                          <pre>{{ history.newValues | json }}</pre>
                        </div>
                      </div>
                    </div>
                    <div *ngSwitchCase="'delete'">
                      <h6>Datos de la actividad eliminada:</h6>
                      <pre>{{ history.previousValues | json }}</pre>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
      
      <!-- Paginación -->
      <nav *ngIf="totalPages > 1" aria-label="Paginación del historial">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="onPageChange(currentPage - 1)" aria-label="Anterior">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
          <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" 
              [class.active]="currentPage === i + 1">
            <a class="page-link" (click)="onPageChange(i + 1)">{{ i + 1 }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="onPageChange(currentPage + 1)" aria-label="Siguiente">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>
   
  